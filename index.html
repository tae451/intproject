<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>MMCC Project</title>
    <link href="styles.css" rel="stylesheet">
    <script src="jquery-3.7.1.min.js"></script>
    <script src="jquery-ui.js"></script>
    
    <script>
        $(document).ready(function () {
            //Initialize windows and hide
            $(".window").draggable({ containment: "body", scroll: false, handle:".titlebar" }); //drag function
            $("#page1").load("testpage.html");
            $(".window").hide();

            //debug parameters
            $(".window").show();

            //init dialogue texts and variables
            let currentDialogue = [""];
            let currentDialogueResponse = [""];
            let dialogueProgress = 0;

            const dialogue = {
                testDialogue: {
                    lines: ["This is my first", "My second message.", "Really last one", "fourth go forth last"],
                    responses: [1, 0, 0, 2],
                },
                introDialogue: {
                    lines: [""],
                    responses: [""]
                }
            };

            /*
            for (let i = 0; i < testDialogue.length; i++) {
                $("#chatwindow").append("<p>" + testDialogue[i] + "</p>")
            }
            */

            //load a dialogue
            function loadDialogues(dialogueName) {
                currentDialogue = dialogue[dialogueName].lines;
                currentDialogueResponse = dialogue[dialogueName].responses;
                dialogueProgress = 0;
            }

            loadDialogues(testDialogue);
            console.log(currentDialogue);
            console.log(currentDialogueResponse);

            //Array to keep windows in order of last interacted with
            let windows = $(".window").toArray(); //array objects are stored as raw DOMs
            let windowIndexRange = 50; //z index range for windows starts at

            //rearrange windows when clicked
            $(".window").mousedown(function () {
                bringToFront(this);
            });

            //bring active window to end of array
            function bringToFront(interactedWindow) {
                windows = windows.filter(a => a !== interactedWindow);
                windows.push(interactedWindow);
                for (let i = 0; i < windows.length; i++) {
                    //console.log(i + " " + $(windows[i]).prop('id'));
                    $(windows[i]).css("z-index", i + windowIndexRange);
                }
                $(".titlebar").removeClass("activetitlebar");
                $(interactedWindow).find(".titlebar").addClass("activetitlebar");
            }

            //TODO: Stages of progress, each has a bit for dialogue or game or whatever

            //taskbar functionality
            $(".taskbutton").click(function () {
                const buttonId = $(this).attr("id"); // id of button (taskbutton)
                const windowEl = $("#" + buttonId.replace("button", "window"))[0]; //parse buttonId to get corresponding window (raw dom)

                if ($(windowEl).is(":visible")) {
                // if ($(windowEl).find(".titlebar").hasClass("activetitlebar")) { //if active window minimize
                    minimizeWindow(windowEl);
                } else { //or show hidden window
                    maximizeWindow(windowEl);
                }
            });

            //functions for handling open and close windows
            function minimizeWindow(cWin) {
                const windowId = $(cWin).attr("id"); // id of window
                const buttonEl = $("#" + windowId.replace("window", "button"))[0]; //parse window -> button id
                //hide window and deactivate button
                $(cWin).hide();
                $(buttonEl).removeClass("activetaskbutton");
            }
            function maximizeWindow(mWin) {
                const windowId = $(mWin).attr("id"); // id of window
                const buttonEl = $("#" + windowId.replace("window", "button"))[0]; //parse window -> button id

                $(mWin).show();
                $(buttonEl).addClass("activetaskbutton");
                bringToFront(mWin);
            }

            //closebutton
            $(".closebutton").on("click", function () {
                minimizeWindow($(this).closest(".window"));
            });
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Raleway&display=swap');
    </style>
</head>

<body>
    <nav id="taskbar">
        <a class="taskbutton" id="browserbutton">Browser</a>
        <a class="taskbutton" id="chatbutton">Dyscord</a>
        <a class="taskbutton" id="settingsbutton">Settings</a>
        <a class="taskbutton" id="filesbutton">FileShark</a>
        <a class="taskbutton" id="gamebutton">DosBot</a>
    </nav>
    <div class="window" id="browserwindow">
        <div class="titlebar">
            <a class="closebutton">X</a>
        </div>
        <div class="pagecontent" id="page1">
            <p>This is page one</p>
        </div>
    </div>
    <div class="window" id="chatwindow">
        <div class="titlebar"></div>
        <p>also a test</p>
    </div>
    <div class="window" id="settingswindow">
        <div class="titlebar"></div>
        <p>these are settings</p>
    </div>
    <div class="window" id="fileswindow">
        <div class="titlebar"></div>
        <p>this is a file explorer</p>
    </div>
    <div class="window" id="gamewindow">
        <div class="titlebar"></div>
        <p>this is games 2</p>
    </div>
</body>

</html>